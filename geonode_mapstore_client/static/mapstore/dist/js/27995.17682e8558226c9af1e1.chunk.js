(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[27995],{838167:(e,t,r)=>{"use strict";r.d(t,{t6:()=>j,k9:()=>w,v0:()=>g,ZP:()=>S});var n=r(675263),o=r.n(n),i=r(124852),l=r.n(i),a=r(868195);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function d(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:String(t)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(d,e);var t,r,n,o,i=(n=d,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(n);if(o){var r=f(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),i.apply(this,arguments)}return t=d,(r=[{key:"render",value:function(){return this.context.intl?l().createElement(a.FormattedDate,s({value:this.props.value},this.props.dateParams)):l().createElement("span",null,this.props.value&&this.props.value.toString()||"")}}])&&c(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),d}(l().Component);d(y,"propTypes",{value:o().object,dateParams:o().object}),d(y,"contextTypes",{intl:o().object}),d(y,"defaultProps",{value:new Date});const b=y;var v=r(615402),h=r(805346),g=h.Z,w=v.Z,j=b;const S={Message:h.Z,HTML:w,DateFormat:j}},427995:(e,t,r)=>{"use strict";r.d(t,{h:()=>x});var n=r(124852),o=r.n(n),i=r(171703),l=r(480681),a=r(855033),u=r.n(a),s=r(351288);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:String(t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}r(472619);var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(a,e);var t,r,n,i,l=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=y(n);if(i){var r=y(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,e)});function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=l.call(this)).state={time:{},seconds:180},e.timer=0,e.startTimer=e.startTimer.bind(m(e)),e.countDown=e.countDown.bind(m(e)),e}return t=a,(r=[{key:"componentDidMount",value:function(){this.startTimer();var e=this.secondsToTime(this.state.seconds);this.setState({time:e})}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return o().createElement(o().Fragment,null,this.state.time.m,":",this.state.time.s)}},{key:"secondsToTime",value:function(e){var t=e%3600,r=t%60;return{h:Math.floor(e/3600),m:Math.floor(t/60),s:String(Math.ceil(r)).padStart(2,"0")}}},{key:"startTimer",value:function(){0===this.timer&&this.state.seconds>0&&(this.timer=setInterval(this.countDown,1e3))}},{key:"countDown",value:function(){var e=this.state.seconds-1;this.setState({time:this.secondsToTime(e),seconds:e}),0===e&&clearInterval(this.timer)}}])&&p(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().Component),v=r(838167),h=r(197395),g=r(375875),w=r.n(g);function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,F(n.key),n)}}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function E(e,t,r){return(t=F(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e){var t=function(e,t){if("object"!=j(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:String(t)}var k=r(675263),_=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(s,e);var t,r,n,i,a=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(n);if(i){var r=T(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),E(P(t=a.call(this,e)),"isBaseFile",(function(e){return["shp","tif","zip"].includes(e.extension)})),E(P(t),"prepareFiles",(function(e){console.log("files1: ",e),e.map((function(e){return Object.defineProperty(e,"status",{value:"begin",writable:!0}),Object.defineProperty(e,"extension",{value:e.name.split(".").slice(-1)[0],writable:!0}),e}));var t=e.findIndex((function(e){return"shp"===e.extension||"tif"===e.extension})),r=e.splice(t,1)[0];return e.unshift(r),e})),E(P(t),"humanFileSize",(function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]})),E(P(t),"uploadFile",(function(e){var r,n=new FormData;e.map((function(e){n.append(e.extension,e)}));var o,i=e[0];if(n.append("title",t.state.newTitle),n.append("importerTargetObjectId",null===(r=t.props)||void 0===r?void 0:r.importerTargetObjectId),t.setState((function(e){return{itemList:e.uploaderFiles.map((function(e){return e.preview===i.preview?Object.assign(e,{status:"uploading"}):e}))}})),o=t.props.serverUrl.includes("localhost")?"http://localhost:8081/":t.props.serverUrl,t.props.importerTargetObjectId){var l,a,u="".concat(o).concat(null===(l=t.props)||void 0===l||null===(a=l.config)||void 0===a?void 0:a.app_name,"/api/").concat(t.props.projectId,"/").concat(t.props.importerConfigKey,"/").concat(t.props.importerTargetObjectId,"/importer-config/");console.log("put to extend: ",u),w().put(u,n,t.uploadManager).then((function(e){t.setState((function(e){return{itemList:e.uploaderFiles.map((function(e){return e.preview===i.preview?Object.assign(e,{status:"complete"}):e}))}})),t.props.setVisibleSimpleViewAttributeForm(!0),t.props.createSimpleViewAttributeForm(null==e?void 0:e.data)}))}else{var s,c,p="".concat(o).concat(null===(s=t.props)||void 0===s||null===(c=s.config)||void 0===c?void 0:c.app_name,"/api/").concat(t.props.projectId,"/").concat(t.props.importerConfigKey,"/importer-create/");w().put(p,n,t.uploadManager).then((function(e){var r;t.setState((function(e){return{itemList:e.uploaderFiles.map((function(e){return e.preview===i.preview?Object.assign(e,{status:"complete"}):e}))}})),null!=e&&null!==(r=e.data)&&void 0!==r&&r.form?(t.props.setVisibleSimpleViewAttributeForm(!0),t.props.createSimpleViewAttributeForm(null==e?void 0:e.data)):t.props.show({message:"Import processing - the layer will appear when it's ready.",title:"Processing started",uid:1e3,position:"tc"})}))}})),E(P(t),"uploadManager",{onUploadProgress:function(e){var r=Math.round(100*e.loaded/e.total);t.props.updateUploadStatus(r)}}),t.state={uploaderFiles:[],newTitle:null},t.beginTooltip=o().createRef(),t}return t=s,(r=[{key:"render",value:function(){var e,t,r,n,i=this;return console.log("simpleViewUploader state: ",this.state),this.props.visibleUploaderPanel?o().createElement("div",{className:"simple-view-panel uploader-panel"},o().createElement("div",{className:"row h4 legend-heading"},"Upload ",null===(e=this.props)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.title," File (",null===(r=this.props)||void 0===r||null===(n=r.config)||void 0===n?void 0:n.filetype,")",o().createElement("span",{className:"btn glyphicon glyphicon-remove legend-close",onClick:function(){return i.props.setVisibleUploaderPanel(!1)}})),this.state.uploaderFiles.length>0?o().createElement(l.Table,{bordered:!0,condensed:!0,hover:!0,ref:this.beginTooltip,style:{tableLayout:"fixed"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{width:"160px",key:"hname"},"Title"),o().createElement("th",{width:"200px",key:"hname"},"Filename"),o().createElement("th",{width:"80px",key:"hsize"},"Filesize"),o().createElement("th",{width:"80px",key:"hlast"},"Modified"),o().createElement("th",{width:"80px",key:"hstatus"},"Status"))),o().createElement("tbody",null,this.state.uploaderFiles&&this.state.uploaderFiles.map((function(e,t){return o().createElement("tr",{key:"row_"+t},o().createElement("td",{key:"title"},i.isBaseFile(e)?o().createElement("input",{id:"newTitle",key:"newTitle",className:"data-title-input",type:"text",value:i.state.newTitle||e.name.split(".").slice(0)[0],onChange:function(e){return i.setState({newTitle:e.target.value})}}):""),o().createElement("td",{key:"name"},e.name),o().createElement("td",{key:"size"},i.humanFileSize(e.size)),o().createElement("td",{key:"last"},o().createElement(v.t6,{value:e.lastModifiedDate})),o().createElement("td",{key:"status"},i.isBaseFile(e)?"begin"===e.status?o().createElement(l.Button,{onClick:function(){return i.uploadFile(i.state.uploaderFiles,i.props.fileType||"file")},style:{borderRadius:"3px"},bsSize:"small",bsStyle:"success"},"Begin"):o().createElement("span",null,o().createElement(l.ProgressBar,{active:!0,bsStyle:"success",now:parseInt(i.props.uploadStatus,10)}),100===parseInt(i.props.uploadStatus,10)?o().createElement("span",null,"importing: ",o().createElement(b,null)):i.props.uploadStatus,isNaN(parseInt(i.props.uploadStatus,10))||100===parseInt(i.props.uploadStatus,10)?"":"%"):null))})))):o().createElement(u(),{key:"dropzone",rejectClassName:"alert-danger",className:"alert alert-info",onDrop:function(e){var t;return i.setState({uploaderFiles:i.prepareFiles(e),newTitle:null==e||null===(t=e[0])||void 0===t?void 0:t.name.split(".").slice(0)[0]})},style:this.props.dropZoneStyle,activeStyle:this.props.dropZoneActiveStyle},o().createElement("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",justifyContent:"center"}},o().createElement("span",{style:{width:"100px",height:"100px",textAlign:"center"}},o().createElement(l.Glyphicon,{glyph:"upload"}),o().createElement("br",null),"Drag files or",o().createElement("br",null),"click here")))):null}}])&&S(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().Component);E(_,"propTypes",{setVisibleUploaderPanel:k.func,updateUploaderFile:k.func,setUploaderFiles:k.func,uploaderFiles:k.object,updateUploadStatus:k.func,uploadStatus:k.string,visibleUploaderPanel:k.bool,serverUrl:k.string,projectId:k.number,newTitle:k.string,dataTypeTitle:k.string,suggestedFileType:k.string,uploadUrl:k.string,fileType:k.string,config:k.object,setVisibleSimpleViewAttributeForm:k.func,createSimpleViewAttributeForm:k.func,show:k.func,importerConfigKey:k.string,importerTargetObjectId:k.number});var x=(0,i.connect)((function(e){var t,r,n,o,i,l,a,u,s,c,p;return{visibleUploaderPanel:null==e||null===(t=e.simpleView)||void 0===t?void 0:t.visibleUploaderPanel,importerConfigKey:null==e||null===(r=e.simpleView)||void 0===r?void 0:r.importerConfigKey,config:null==e||null===(n=e.simpleView)||void 0===n||null===(o=n.config)||void 0===o||null===(i=o.importer_config)||void 0===i?void 0:i[null==e||null===(l=e.simpleView)||void 0===l?void 0:l.importerConfigKey],serverUrl:null==e||null===(a=e.gnsettings)||void 0===a?void 0:a.geonodeUrl,projectId:null==e||null===(u=e.simpleView)||void 0===u||null===(s=u.config)||void 0===s?void 0:s.project_id,uploadStatus:(null==e||null===(c=e.simpleView)||void 0===c?void 0:c.uploadStatus)||0,importerTargetObjectId:null==e||null===(p=e.simpleView)||void 0===p?void 0:p.importerTargetObjectId}}),(function(e){return{setVisibleUploaderPanel:function(t,r,n){return e((0,s.setVisibleUploaderPanel)(t,r,n))},updateUploadStatus:function(t){return e((0,s.updateUploadStatus)(t))},setVisibleSimpleViewAttributeForm:function(t){return e((0,s.setVisibleSimpleViewAttributeForm)(t))},createSimpleViewAttributeForm:function(t,r){return e((0,s.createSimpleViewAttributeForm)(t,r))},show:function(t,r){return e((0,h.show)(t,r))}}}))(_)}}]);