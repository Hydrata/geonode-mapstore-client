(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[70082],{615402:(n,t,e)=>{"use strict";e.d(t,{Z:()=>E});var r=e(45697),o=e.n(r),a=e(124852),i=e.n(a);function u(n){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u(n)}function l(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,v(r.key),r)}}function c(n,t,e){return t=d(t),function(n,t){if(t&&("object"==u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}(n,s()?Reflect.construct(t,e||[],d(n).constructor):t.apply(n,e))}function s(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(n){}return(s=function(){return!!n})()}function d(n){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},d(n)}function A(n,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},A(n,t)}function f(n,t,e){return(t=v(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function v(n){var t=function(n,t){if("object"!=u(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var r=e.call(n,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==u(t)?t:t+""}var _=e(868195).FormattedHTMLMessage,p=function(n){function t(){return function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,t,arguments)}return function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&A(n,t)}(t,n),e=t,(r=[{key:"render",value:function(){return this.context.intl?i().createElement(_,{id:this.props.msgId,values:this.props.msgParams}):i().createElement("span",null,this.props.msgId||"")}}])&&l(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}(i().Component);f(p,"propTypes",{msgId:o().string.isRequired,msgParams:o().object}),f(p,"contextTypes",{intl:o().object});const E=p},368658:(n,t,e)=>{function r(n){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r(n)}function o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?o(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):o(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function i(n,t,e){return(t=function(n){var t=function(n,t){if("object"!=r(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var o=e.call(n,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==r(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var u=e(197395).SHOW_NOTIFICATION,l=e(423570),c="INIT_ANUGA",s="SET_ANUGA_INPUT_MENU",d="SET_ANUGA_SCENARIO_MENU",A="SET_ANUGA_RESULT_MENU",f="SET_NETWORK_MENU",v="SET_REVIEW_PANEL",_="SET_PUBLICATION_PANEL",p="SET_ANUGA_PROJECT_DATA",E="SET_ANUGA_SCENARIO_DATA",g="SET_ANUGA_BOUNDARY_DATA",S="SET_ANUGA_FRICTION_DATA",N="SET_ANUGA_INFLOW_DATA",O="SET_ANUGA_STRUCTURE_DATA",b="SET_ANUGA_FULL_MESH_DATA",T="SET_ANUGA_MESH_REGION_DATA",y="SET_NETWORK_DATA",U="SET_LUMPED_CATCHMENT_DATA",D="SET_ANUGA_NODES_DATA",m="SET_ANUGA_LINKS_DATA",R="SET_PUBLICATION_DATA",h="CREATE_ANUGA_BOUNDARY",I="CREATE_ANUGA_FRICTION",C="CREATE_ANUGA_INFLOW",w="CREATE_ANUGA_STRUCTURE",G="CREATE_ANUGA_MESH_REGION",M="CREATE_NETWORK",P="CREATE_LUMPED_CATCHMENT",L="CREATE_NODES",j="CREATE_LINKS",k="CREATE_FIGURE",F="ADD_ANUGA_BOUNDARY",W="ADD_ANUGA_FRICTION",H="ADD_ANUGA_INFLOW",x="ADD_ANUGA_STRUCTURE",K="ADD_ANUGA_FULL_MESH",B="ADD_ANUGA_MESH_REGION",V="ADD_ANUGA_NETWORK",Y="ADD_LUMPED_CATCHMENT",Z="ADD_NODES",$="ADD_LINKS",J="ADD_COMPARISON",z="SET_ANUGA_ELEVATION_DATA",Q="CREATE_ANUGA_ELEVATION_FROM_LAYER",X="SET_ADD_ANUGA_ELEVATION_DATA",q="ADD_ANUGA_SCENARIO",nn="RUN_ANUGA_SCENARIO",tn="RUN_ANUGA_SCENARIO_SUCCESS",en="RUN_NETWORK",rn="RUN_NETWORK_SUCCESS",on="SAVE_ANUGA_SCENARIO",an="SAVE_ANUGA_SCENARIO_SUCCESS",un="SAVE_ANUGA_SCENARIO_ERROR",ln="DELETE_ANUGA_SCENARIO",cn="SHOW_ANUGA_SCENARIO_LOG",sn="SHOW_ANUGA_RUN_MENU",dn="START_ANUGA_SCENARIO_POLLING",An="STOP_ANUGA_SCENARIO_POLLING",fn="START_ANUGA_ELEVATION_POLLING",vn="STOP_ANUGA_ELEVATION_POLLING",_n="START_ANUGA_MODEL_CREATION_POLLING",pn="STOP_ANUGA_MODEL_CREATION_POLLING",En="START_COMPARISON_POLLING",gn="STOP_COMPARISON_POLLING",Sn="SET_COMPARISON_DATA",Nn="SET_ANUGA_POLLING_DATA",On="UPDATE_ANUGA_SCENARIO",bn="UPDATE_NETWORK",Tn="SELECT_ANUGA_SCENARIO",yn="SET_CREATING_ANUGA_LAYER",Un="SET_ANUGA_SCENARIO_IS_LOADED",Dn="CANCEL_ANUGA_RUN",mn="UPDATE_COMPUTE_INSTANCE",Rn="UPDATE_COMPUTE_INSTANCE_SUCCESS",hn="TOGGLE_SCENARIO_SELECTED",In="SHOW_MANAGE_ACCOUNT",Cn="COMPARE_SCENARIOS",wn="COMPARE_SCENARIOS_SUCCESS",Gn="UPDATE_ANUGA_RESOURCES",Mn="SET_ANUGA_RESOURCES",Pn="FIX_ANUGA_GROUPS";n.exports={INIT_ANUGA:c,initAnuga:function(){return{type:c}},SET_ANUGA_INPUT_MENU:s,setAnugaInputMenu:function(n){return{type:s,visible:n}},SET_ANUGA_SCENARIO_MENU:d,setAnugaScenarioMenu:function(n){return{type:d,visible:n}},SET_ANUGA_RESULT_MENU:A,setAnugaResultMenu:function(n){return{type:A,visible:n}},SET_REVIEW_PANEL:v,setReviewPanel:function(n){return{type:v,visible:n}},SET_PUBLICATION_PANEL:_,setPublicationPanel:function(n){return{type:_,visible:n}},SET_ANUGA_PROJECT_DATA:p,setAnugaProjectData:function(n){return{type:p,data:n}},SET_ANUGA_SCENARIO_DATA:E,setAnugaScenarioData:function(n){return{type:E,scenarios:n}},SET_ANUGA_ELEVATION_DATA:z,setAnugaElevationData:function(n){return{type:z,data:n}},SET_ANUGA_BOUNDARY_DATA:g,setAnugaBoundaryData:function(n){return{type:g,data:n}},SET_ANUGA_FRICTION_DATA:S,setAnugaFrictionData:function(n){return{type:S,data:n}},SET_ANUGA_INFLOW_DATA:N,setAnugaInflowData:function(n){return{type:N,data:n}},SET_ANUGA_STRUCTURE_DATA:O,setAnugaStructureData:function(n){return{type:O,data:n}},SET_ANUGA_FULL_MESH_DATA:b,setAnugaFullMeshData:function(n){return{type:b,data:n}},SET_ANUGA_MESH_REGION_DATA:T,setAnugaMeshRegionData:function(n){return{type:T,data:n}},SET_NETWORK_DATA:y,setNetworkData:function(n){return{type:y,data:n}},SET_LUMPED_CATCHMENT_DATA:U,setCatchmentData:function(n){return{type:U,data:n}},SET_ANUGA_NODES_DATA:D,setAnugaNodesData:function(n){return{type:D,data:n}},SET_ANUGA_LINKS_DATA:m,setAnugaLinksData:function(n){return{type:m,data:n}},SET_PUBLICATION_DATA:R,setPublicationData:function(n){return{type:R,data:n}},CREATE_ANUGA_BOUNDARY:h,createAnugaBoundary:function(n){return{type:h,boundaryTitle:n}},CREATE_ANUGA_FRICTION:I,createAnugaFriction:function(n){return{type:I,frictionTitle:n}},CREATE_ANUGA_INFLOW:C,createAnugaInflow:function(n){return{type:C,inflowTitle:n}},CREATE_ANUGA_STRUCTURE:w,createAnugaStructure:function(n){return{type:w,structureTitle:n}},CREATE_ANUGA_MESH_REGION:G,createAnugaMeshRegion:function(n){return{type:G,meshRegionTitle:n}},CREATE_NETWORK:M,createNetwork:function(n){return{type:M,networkTitle:n}},CREATE_LUMPED_CATCHMENT:P,createCatchment:function(n){return{type:P,catchmentTitle:n}},CREATE_NODES:L,createNodes:function(n){return{type:L,nodesTitle:n}},CREATE_LINKS:j,createLinks:function(n){return{type:j,linksTitle:n}},CREATE_FIGURE:k,createFigure:function(n,t){return{type:k,figureTitle:n,publicationId:t}},ADD_ANUGA_BOUNDARY:F,addAnugaBoundary:function(){return{type:F}},ADD_ANUGA_FRICTION:W,addAnugaFriction:function(){return{type:W}},ADD_ANUGA_INFLOW:H,addAnugaInflow:function(){return{type:H}},ADD_ANUGA_STRUCTURE:x,addAnugaStructure:function(){return{type:x}},ADD_ANUGA_MESH_REGION:B,addAnugaMeshRegion:function(){return{type:B}},ADD_ANUGA_FULL_MESH:K,addAnugaFullMesh:function(){return{type:K}},ADD_NETWORK:V,addNetwork:function(){return{type:V}},ADD_LUMPED_CATCHMENT:Y,addCatchment:function(){return{type:Y}},ADD_NODES:Z,addNodes:function(){return{type:Z}},ADD_LINKS:$,addLinks:function(){return{type:$}},ADD_COMPARISON:J,addComparison:function(){return{type:J}},SET_ADD_ANUGA_ELEVATION_DATA:X,setAddAnugaElevation:function(n){return{type:X,visible:n}},CREATE_ANUGA_ELEVATION_FROM_LAYER:Q,createAnugaElevationFromLayer:function(n,t){return{type:Q,pk:n,title:t}},SAVE_ANUGA_SCENARIO:on,saveAnugaScenario:function(n){return{type:on,scenario:n}},ADD_ANUGA_SCENARIO:q,addAnugaScenario:function(){return{type:q}},SAVE_ANUGA_SCENARIO_SUCCESS:an,saveAnugaScenarioSuccess:function(n){return function(t){t({type:u,title:"Success",autoDismiss:6,position:"tc",message:"Scenario ID: ".concat(n.id," building"),uid:l(),level:"success"}),t({type:an,scenario:n})}},SAVE_ANUGA_SCENARIO_ERROR:un,saveAnugaScenarioError:function(n){return function(t){t({type:u,title:"Error",autoDismiss:60,position:"tc",message:"Error saving scenario: ".concat(JSON.stringify(null==n?void 0:n.data)),uid:l(),level:"error"}),t({type:un,error:n})}},DELETE_ANUGA_SCENARIO:ln,deleteAnugaScenario:function(n){return{type:ln,scenario:n}},DELETE_ANUGA_SCENARIO_SUCCESS:"DELETE_ANUGA_SCENARIO_SUCCESS",deleteAnugaScenarioSuccess:function(n){return function(t){t({type:u,title:"Success",autoDismiss:6,position:"tc",message:"Scenario ID: ".concat(n.id," deleted"),uid:l(),level:"info"}),t({type:c})}},RUN_ANUGA_SCENARIO:nn,runAnugaScenario:function(n,t){return{type:nn,scenario:n,computeInstanceId:t}},RUN_ANUGA_SCENARIO_SUCCESS:tn,runAnugaScenarioSuccess:function(n){return function(t){t({type:u,title:"Success",autoDismiss:6,position:"tc",message:"Scenario running",uid:l(),level:"success"}),t({type:tn,scenario:n})}},SET_NETWORK_MENU:f,setNetworkMenu:function(n){return{type:f,visible:n}},RUN_NETWORK:en,runNetwork:function(n){return{type:en,network:n}},RUN_NETWORK_SUCCESS:rn,runNetworkSuccess:function(n){return function(t){t({type:u,title:"Success",autoDismiss:6,position:"tc",message:"Network Calculated",uid:l(),level:"success"}),t({type:rn,network:n})}},UPDATE_NETWORK:bn,updateNetwork:function(n,t){return{type:bn,network:a(a({},n),t)}},UPDATE_ANUGA_SCENARIO:On,updateAnugaScenario:function(n,t){return{type:On,scenario:a(a({},n),t)}},SELECT_ANUGA_SCENARIO:Tn,selectAnugaScenario:function(n){return{type:Tn,scenario:n}},SHOW_ANUGA_SCENARIO_LOG:cn,showAnugaScenarioLog:function(n){return{type:cn,scenarioId:n}},SHOW_ANUGA_RUN_MENU:sn,showAnugaRunMenu:function(n){return{type:sn,visible:n}},START_ANUGA_SCENARIO_POLLING:dn,startAnugaScenarioPolling:function(){return{type:dn}},STOP_ANUGA_SCENARIO_POLLING:An,stopAnugaScenarioPolling:function(){return{type:An}},START_ANUGA_ELEVATION_POLLING:fn,startAnugaElevationPolling:function(){return{type:fn}},STOP_ANUGA_ELEVATION_POLLING:vn,stopAnugaElevationPolling:function(){return{type:vn}},START_ANUGA_MODEL_CREATION_POLLING:_n,startAnugaModelCreationPolling:function(){return{type:_n}},STOP_ANUGA_MODEL_CREATION_POLLING:pn,stopAnugaModelCreationPolling:function(){return{type:pn}},START_COMPARISON_POLLING:En,startComparisonPolling:function(){return{type:En}},STOP_COMPARISON_POLLING:gn,stopComparisonPolling:function(){return{type:gn}},SET_COMPARISON_DATA:Sn,setComparisonData:function(n){return{type:Sn,data:n}},SET_ANUGA_POLLING_DATA:Nn,setAnugaPollingData:function(n){return{type:Nn,scenarios:n}},SET_CREATING_ANUGA_LAYER:yn,setCreatingAnugaLayer:function(n){return{type:yn,isCreatingAnugaLayer:n}},SET_ANUGA_SCENARIO_IS_LOADED:Un,setAnugaScenarioResultsLoaded:function(n,t){return{type:Un,scenarioId:n,isLoaded:t}},CANCEL_ANUGA_RUN:Dn,cancelAnugaRun:function(n,t){return{type:Dn,scenario:n,computeInstanceId:t}},UPDATE_COMPUTE_INSTANCE:mn,updateComputeInstance:function(){return{type:mn}},UPDATE_COMPUTE_INSTANCE_SUCCESS:Rn,updateComputeInstanceSuccess:function(n){return{type:Rn,data:n}},TOGGLE_SCENARIO_SELECTED:hn,toggleScenarioSelected:function(n){return{type:hn,scenario:n}},SHOW_MANAGE_ACCOUNT:In,showManageAccount:function(n){return{type:In,visible:n}},COMPARE_SCENARIOS:Cn,compareScenarios:function(n){return{type:Cn,scenarios:n}},COMPARE_SCENARIOS_SUCCESS:wn,compareScenariosSuccess:function(n){return function(t){t({type:u,title:"Success",autoDismiss:6,position:"tc",message:"Scenario comparison started",uid:l(),level:"success"}),t({type:wn,scenarios:n})}},UPDATE_ANUGA_RESOURCES:Gn,updateAnugaResources:function(n){return{type:Gn,action:n,pageSize:arguments.length>1&&void 0!==arguments[1]?arguments[1]:100}},SET_ANUGA_RESOURCES:Mn,setAnugaResources:function(n){return{type:Mn,data:n}},FIX_ANUGA_GROUPS:Pn,fixAnugaGroups:function(){return{type:Pn}}}},300806:(n,t,e)=>{"use strict";e.d(t,{gE:()=>O,GM:()=>b,z1:()=>T,Z6:()=>y,Zu:()=>U,Rf:()=>D,F7:()=>m,EE:()=>R,ax:()=>h,b2:()=>I,sW:()=>C,Ye:()=>w,dd:()=>G,rJ:()=>M,As:()=>P,lA:()=>L,T9:()=>j,QH:()=>k,XO:()=>F,Qc:()=>W,Ok:()=>H,AC:()=>x,Xv:()=>K,yN:()=>B,oq:()=>V,Qy:()=>Y,BA:()=>Z,Og:()=>$,h2:()=>J,bp:()=>z,d:()=>Q,E_:()=>X,YL:()=>q,o$:()=>nn,HQ:()=>tn});var r=e(49977),o=e.n(r),a=e(375875),i=e.n(a),u=e(580416),l=e(197395),c=e(801550),s=e(73443),d=e(433528),A=e(368658),f=e(351288),v=e(926036),_=e(643892),p=e(55035);function E(n){return function(n){if(Array.isArray(n))return g(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,t){if(n){if("string"==typeof n)return g(n,t);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?g(n,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=Array(t);e<t;e++)r[e]=n[e];return r}var S=function(n,t){var e;if(0===(null===(e=n.data)||void 0===e?void 0:e.length))return o().Observable.empty();var r=[(0,A.initAnuga)(),(0,A.setCreatingAnugaLayer)(!1)];return n.data.map((function(n){0===t.getState().layers.flat.filter((function(t){return t.name===(null==n?void 0:n.name)})).length&&(r.unshift((0,u.A4)(n)),r.push((0,l.show)({message:"Adding new layers... You should save your project.",title:"New layers found",uid:1e3,position:"tc"})))})),o().Observable.from(r)},N=[{endpoint:"scenario",action:A.setAnugaScenarioData},{endpoint:"boundary",action:A.setAnugaBoundaryData},{endpoint:"elevation",action:A.setAnugaElevationData},{endpoint:"inflow",action:A.setAnugaInflowData},{endpoint:"structure",action:A.setAnugaStructureData},{endpoint:"friction",action:A.setAnugaFrictionData},{endpoint:"full-mesh",action:A.setAnugaFullMeshData},{endpoint:"mesh-region",action:A.setAnugaMeshRegionData},{endpoint:"network",action:A.setNetworkData},{endpoint:"catchment",action:A.setCatchmentData},{endpoint:"nodes",action:A.setAnugaNodesData},{endpoint:"links",action:A.setAnugaLinksData},{endpoint:"comparison",action:A.setComparisonData},{endpoint:"publication",action:A.setPublicationData}],O=function(n,t){return n.ofType(A.INIT_ANUGA,f.UPDATE_DATASET_TITLE_SUCCESS).filter((function(){return t.getState().gnresource.id})).switchMap((function(){return o().Observable.from(i().post("/anuga/api/project/get_project_from_map_id/",{mapId:t.getState().gnresource.id})).catch((function(n){return console.log("**",n),o().Observable.of("error")}))})).filter((function(n){return(null==n?void 0:n.status)<=400})).filter((function(){var n,e;return!(null===(n=t.getState())||void 0===n||null===(e=n.security)||void 0===e||!e.user)})).switchMap((function(n){return o().Observable.from(i().get("/anuga/api/project/".concat(n.data.projectId,"/"))).catch((function(n){return console.log("xx",n),o().Observable.of("error")})).switchMap((function(t){var e,r=n.data.projectId,a=N.map((function(n){var t=n.endpoint,e=n.action;return function(n,t){return o().Observable.from(i().get("/anuga/api/".concat(t,"/").concat(n,"/"))).catch((function(n){return console.error(n),o().Observable.of({data:{}})})).switchMap((function(n){return o().Observable.of(n.data)}))}(t,r).map(e)}));return o().Observable.of((0,A.setAnugaProjectData)(t.data),(0,A.fixAnugaGroups)(),(0,f.setSvConfig)(t.data.simple_view_config)).concat((e=o().Observable).merge.apply(e,E(a)),o().Observable.of((0,A.startAnugaScenarioPolling)()))}))}))},b=function(n){return n.ofType(A.START_ANUGA_MODEL_CREATION_POLLING).switchMap((function(){return o().Observable.timer(0,1e4).takeUntil(n.ofType(A.STOP_ANUGA_MODEL_CREATION_POLLING)).switchMap((function(){return o().Observable.concat(o().Observable.of((0,A.addAnugaBoundary)()),o().Observable.of((0,A.addAnugaFriction)()),o().Observable.of((0,A.addAnugaStructure)()),o().Observable.of((0,A.addAnugaInflow)()),o().Observable.of((0,A.addAnugaFullMesh)()),o().Observable.of((0,A.addAnugaMeshRegion)()),o().Observable.of((0,A.addNetwork)()),o().Observable.of((0,A.addCatchment)()),o().Observable.of((0,A.addNodes)()),o().Observable.of((0,A.addLinks)()))}))}))},T=function(n,t){return n.ofType(A.START_ANUGA_ELEVATION_POLLING).switchMap((function(){return o().Observable.timer(0,6e3).takeUntil(n.ofType(A.STOP_ANUGA_ELEVATION_POLLING)).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/elevation/available/"))).catch((function(n){return n}))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){var e,r,a,i,l,d,v,_,p,E;if((null===(e=n.data)||void 0===e?void 0:e.length)<2)return o().Observable.empty();var g=n.data[0],S=null===(r=n.data)||void 0===r?void 0:r[1];return o().Observable.concat(o().Observable.of((0,A.stopAnugaElevationPolling)()),o().Observable.of((function(){var n,e,r,o=(null===(n=t.getState())||void 0===n||null===(e=n.layers)||void 0===e||null===(r=e.flat)||void 0===r?void 0:r.filter((function(n){return"wms"===n.type&&"background"!==n.group})))||[];return(0,u.oZ)(o)})),o().Observable.of((0,u.A4)(g)),o().Observable.of((0,u.A4)(S)),o().Observable.of((0,c.Px)(null===(a=n.data[0])||void 0===a||null===(i=a.bbox)||void 0===i?void 0:i.bounds,null===(l=n.data[0])||void 0===l||null===(d=l.bbox)||void 0===d?void 0:d.crs,20)),o().Observable.of((0,f.updateUploadStatus)("Complete")),o().Observable.of((0,s.nY)()),o().Observable.of((0,A.initAnuga)()),o().Observable.of((0,A.startAnugaModelCreationPolling)()),o().Observable.of((function(){var n,e,r,o=(null===(n=t.getState())||void 0===n||null===(e=n.layers)||void 0===e||null===(r=e.flat)||void 0===r?void 0:r.filter((function(n){return"wms"===n.type&&"background"!==n.group})))||[];return(0,u.oZ)(o)})),o().Observable.of((0,u.Dv)("Input Data.Elevations","Input Data",null===(v=t.getState())||void 0===v||null===(_=v.layers.groups.filter((function(n){return"Input Data"===n.id})))||void 0===_||null===(p=_[0])||void 0===p||null===(E=p.nodes)||void 0===E?void 0:E.length)))}))}))},y=function(n,t){return n.ofType(A.START_ANUGA_SCENARIO_POLLING).switchMap((function(){return o().Observable.timer(0,8e3).takeUntil(n.ofType(A.STOP_ANUGA_SCENARIO_POLLING)).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/scenario/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return o().Observable.of((0,A.setAnugaPollingData)(n.data)).switchMap((function(n){var e,r,a,i,l,c,s,d,f,v,_,p,E,g,S,N,O,b,T,y,U,D,m,R,h,I,C,w,G=(null===(e=n.scenarios)||void 0===e?void 0:e.filter((function(n){var t;return"complete"===(null===(t=n.latest_run)||void 0===t?void 0:t.status)}))).filter((function(n){var e,r,o;return null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(o=r.scenarios)||void 0===o?void 0:o.filter((function(e){var r,o,a,i,u,l,c,s,d,A,f,v=(null==e?void 0:e.id)===n.id,_=!e.isLoaded,p=(r=e,d=null==(o=t.getState())||null===(a=o.layers)||void 0===a||null===(i=a.flat)||void 0===i?void 0:i.filter((function(n){var t,e;return n.name===(null==r||null===(t=r.latest_run)||void 0===t||null===(e=t.gn_layer_depth_max)||void 0===e?void 0:e.name)})),A=null==o||null===(u=o.layers)||void 0===u||null===(l=u.flat)||void 0===l?void 0:l.filter((function(n){var t,e;return n.name===(null==r||null===(t=r.latest_run)||void 0===t||null===(e=t.gn_layer_depth_integrated_velocity_max)||void 0===e?void 0:e.name)})),f=null==o||null===(c=o.layers)||void 0===c||null===(s=c.flat)||void 0===s?void 0:s.filter((function(n){var t,e;return n.name===(null==r||null===(t=r.latest_run)||void 0===t||null===(e=t.gn_layer_velocity_max)||void 0===e?void 0:e.name)})),!(null!=d&&d.length&&null!=A&&A.length&&null!=f&&f.length));return v&&_&&p?n:null}))[0]}))[0],M=null===(r=t.getState())||void 0===r||null===(a=r.layers)||void 0===a||null===(i=a.flat)||void 0===i?void 0:i.map((function(n){return null==n?void 0:n.name})),P=(null===(l=t.getState())||void 0===l||null===(c=l.layers)||void 0===c||null===(s=c.flat)||void 0===s?void 0:s.filter((function(n){return"wms"===(null==n?void 0:n.type)&&"background"!==(null==n?void 0:n.group)})))||[],L=[null==G||null===(d=G.latest_run)||void 0===d||null===(f=d.gn_layer_depth_integrated_velocity_max)||void 0===f?void 0:f.title,null==G||null===(v=G.latest_run)||void 0===v||null===(_=v.gn_layer_depth_max)||void 0===_?void 0:_.title,null==G||null===(p=G.latest_run)||void 0===p||null===(E=p.gn_layer_velocity_max)||void 0===E?void 0:E.title],j=null===(g=t.getState())||void 0===g||null===(S=g.layers)||void 0===S||null===(N=S.flat)||void 0===N?void 0:N.filter((function(n){return L.includes(null==n?void 0:n.title)}));if(G&&null!=G&&null!==(O=G.latest_run)&&void 0!==O&&null!==(b=O.gn_layer_depth_integrated_velocity_max)&&void 0!==b&&b.catalogURL&&null!=G&&null!==(T=G.latest_run)&&void 0!==T&&null!==(y=T.gn_layer_depth_max)&&void 0!==y&&y.catalogURL&&null!=G&&null!==(U=G.latest_run)&&void 0!==U&&null!==(D=U.gn_layer_velocity_max)&&void 0!==D&&D.catalogURL&&!M.includes(null==G||null===(m=G.latest_run)||void 0===m||null===(R=m.gn_layer_depth_integrated_velocity_max)||void 0===R?void 0:R.name)&&!M.includes(null==G||null===(h=G.latest_run)||void 0===h||null===(I=h.gn_layer_depth_max)||void 0===I?void 0:I.name)&&!M.includes(null==G||null===(C=G.latest_run)||void 0===C||null===(w=C.gn_layer_velocity_max)||void 0===w?void 0:w.name)){var k,F,W,H=G.latest_run.gn_layer_depth_integrated_velocity_max,x=G.latest_run.gn_layer_depth_max,K=G.latest_run.gn_layer_velocity_max;return o().Observable.concat(o().Observable.of((0,u.$o)(null==j||null===(k=j[0])||void 0===k?void 0:k.id)),o().Observable.of((0,u.$o)(null==j||null===(F=j[1])||void 0===F?void 0:F.id)),o().Observable.of((0,u.$o)(null==j||null===(W=j[2])||void 0===W?void 0:W.id)),o().Observable.of((0,A.setAnugaPollingData)(n.scenarios)),o().Observable.of((0,u.A4)(H)),o().Observable.of((0,u.A4)(x)),o().Observable.of((0,u.A4)(K)),o().Observable.of((0,A.setAnugaScenarioResultsLoaded)(null==G?void 0:G.id,!0)),o().Observable.of((0,u.oZ)(P)))}return o().Observable.of((0,A.setAnugaPollingData)(n.scenarios))}))}))}))}))},U=function(n,t){return n.ofType(A.DELETE_ANUGA_SCENARIO).concatMap((function(n){var e,r,a;return o().Observable.from(i().delete("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/").concat(n.scenario.id,"/")))})).concatMap((function(n){return o().Observable.of((0,A.deleteAnugaScenarioSuccess)(n.data))}))},D=function(n,t){return n.ofType(A.RUN_ANUGA_SCENARIO).concatMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/").concat(n.scenario.id,"/run/"),n).then((function(n){return(0,A.runAnugaScenarioSuccess)(n.data)})))})).concatMap((function(){return o().Observable.of((0,A.setAnugaScenarioMenu)(!0))}))},m=function(n,t){return n.ofType(A.CANCEL_ANUGA_RUN).concatMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/").concat(n.scenario.id,"/run/"),n))})).concatMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/").concat(n.scenario.id,"/cancel/"),{runId:n.scenario.latest_run.id}))})).concatMap((function(){return o().Observable.of((0,l.show)({message:"cancelling..."},"warning"))}))},R=function(n,t){return n.ofType(A.SAVE_ANUGA_SCENARIO).switchMap((function(n){var e,r,a,u,l,c;return n.scenario.log=n.scenario.log||"anuga log",n.scenario.id?o().Observable.from(i().put("/anuga/api/".concat(null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,"/scenario/").concat(n.scenario.id,"/"),n.scenario).then((function(n){return(0,A.saveAnugaScenarioSuccess)(n.data)})).catch((function(n){return(0,A.saveAnugaScenarioError)(n)}))):o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/"),n.scenario).then((function(n){return(0,A.saveAnugaScenarioSuccess)(n.data)})).catch((function(n){return(0,A.saveAnugaScenarioError)(n)})))}))},h=function(n,t){return n.ofType(A.COMPARE_SCENARIOS).concatMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/scenario/compare/"),n.scenarios).then((function(n){return(0,A.compareScenariosSuccess)(n.data)})))}))},I=function(n,t){return n.ofType(f.SET_OPEN_MENU_GROUP_ID).filter((function(n){return"Results"===(null==n?void 0:n.openMenuGroupId)})).switchMap((function(){return o().Observable.timer(0,1e4).takeUntil(n.ofType(A.STOP_COMPARISON_POLLING)).switchMap((function(){return o().Observable.concat(o().Observable.of((0,A.addComparison)()))}))}))},C=function(n,t){return n.ofType(A.RUN_NETWORK).concatMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/network/").concat(n.network.id,"/run/"),n.network).then((function(n){return(0,A.runNetworkSuccess)(n.data)})))})).concatMap((function(){return o().Observable.of((0,A.setNetworkMenu)(!0))}))},w=function(n,t){return n.ofType(A.CREATE_ANUGA_BOUNDARY).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/boundary/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.boundaryTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addAnugaBoundary)())}))},G=function(n,t){return n.ofType(A.ADD_ANUGA_BOUNDARY).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/boundary/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},M=function(n,t){return n.ofType(A.ADD_COMPARISON).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/comparison/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},P=function(n,t){return n.ofType(A.CREATE_ANUGA_FRICTION).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/friction/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.frictionTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addAnugaFriction)())}))},L=function(n,t){return n.ofType(A.ADD_ANUGA_FRICTION).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/friction/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},j=function(n,t){return n.ofType(A.CREATE_ANUGA_INFLOW).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/inflow/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.inflowTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addAnugaInflow)())}))},k=function(n,t){return n.ofType(A.ADD_ANUGA_INFLOW).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/inflow/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},F=function(n,t){return n.ofType(A.CREATE_ANUGA_STRUCTURE).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/structure/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.structureTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addAnugaStructure)())}))},W=function(n,t){return n.ofType(A.ADD_ANUGA_STRUCTURE).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/structure/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},H=function(n,t){return n.ofType(A.ADD_ANUGA_FULL_MESH).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/full-mesh/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},x=function(n,t){return n.ofType(A.ADD_ANUGA_MESH_REGION).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/mesh-region/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},K=function(n,t){return n.ofType(A.ADD_LUMPED_CATCHMENT).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/catchment/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},B=function(n,t){return n.ofType(A.ADD_NODES).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/nodes/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},V=function(n,t){return n.ofType(A.ADD_LINKS).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/links/available/")).catch((function(n){return n}))).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){return S(n,t)}))}))},Y=function(n,t){return n.ofType(A.CREATE_ANUGA_MESH_REGION).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/mesh-region/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.meshRegionTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addAnugaMeshRegion)())}))},Z=function(n,t){return n.ofType(A.CREATE_NETWORK).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/network/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.networkTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addNetwork)())}))},$=function(n,t){return n.ofType(A.CREATE_FIGURE).switchMap((function(n){var e,r,a;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/publication/").concat(n.publicationId,"/create-figure/"),{title:n.figureTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(n){var t;return console.log("response1:",n),window.open(null==n||null===(t=n.data)||void 0===t?void 0:t.detail_url,"_blank").focus(),o().Observable.of((0,A.initAnuga)())}))},J=function(n,t){return n.ofType(A.CREATE_LUMPED_CATCHMENT).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/catchment/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.catchmentTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addCatchment)())}))},z=function(n,t){return n.ofType(A.CREATE_NODES).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/nodes/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.nodesTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addNodes)())}))},Q=function(n,t){return n.ofType(A.CREATE_LINKS).switchMap((function(n){var e,r,a,u,l,c;return o().Observable.from(i().post("/anuga/api/".concat(null===(e=t.getState())||void 0===e||null===(r=e.anuga)||void 0===r||null===(a=r.projectData)||void 0===a?void 0:a.id,"/links/"),{project:null===(u=t.getState())||void 0===u||null===(l=u.anuga)||void 0===l||null===(c=l.projectData)||void 0===c?void 0:c.id,title:n.linksTitle}).catch((function(n){return n})))})).filter((function(n){return(null==n?void 0:n.status)<=400})).switchMap((function(){return o().Observable.of((0,A.addLinks)())}))},X=function(n,t){return n.ofType(A.UPDATE_COMPUTE_INSTANCE).switchMap((function(){var n,e,r;return o().Observable.from(i().get("/anuga/api/".concat(null===(n=t.getState())||void 0===n||null===(e=n.anuga)||void 0===e||null===(r=e.projectData)||void 0===r?void 0:r.id,"/compute-instance/"))).switchMap((function(n){return o().Observable.of((0,A.updateComputeInstanceSuccess)(n.data))}))}))},q=function(n,t){return n.ofType(d.IN).concatMap((function(n){return o().Observable.of(n)})).filter((function(){return["geonode:bdy_","geonode:inf_","geonode:str_","geonode:fri_","geonode:mes_"].some((function(n){var e,r;return null===(e=t.getState())||void 0===e||null===(r=e.featuregrid)||void 0===r?void 0:r.selectedLayer.includes(n)}))})).concatMap((function(n){var e,r,a,i,u;return null!=n&&null!==(e=n.features)&&void 0!==e&&e[0]&&(null===(r=Object.keys(null==n||null===(a=n.features)||void 0===a?void 0:a[0]))||void 0===r?void 0:r.length)>0?o().Observable.empty():(n.features[0].properties={"geonode:bdy_":{location:"External",boundary:"Dirichlet"},"geonode:inf_":{type:"Rainfall",data:100},"geonode:str_":{method:"Holes"},"geonode:fri_":{manning:.035},"geonode:mes_":{resolution:10}}[null===(i=t.getState())||void 0===i||null===(u=i.featuregrid)||void 0===u?void 0:u.selectedLayer.substring(0,12)],o().Observable.of(n))}))},nn=function(n,t){return n.ofType(f.UPDATE_DATASET_TITLE).switchMap((function(n){return o().Observable.from(i().get("/api/v2/datasets?search=".concat(n.datasetName.split("geonode:")[1],"&search_fields=name"))).switchMap((function(e){var r,a,u,l,c,s,d,A=parseInt(null==e||null===(r=e.data)||void 0===r||null===(a=r.datasets)||void 0===a||null===(u=a[0])||void 0===u?void 0:u.pk,10),f=null===(l=(0,v.Z7)(null==t?void 0:t.getState()).filter((function(n){return n.gn_layer===A})))||void 0===l?void 0:l[0];return o().Observable.from(i().patch("/anuga/api/".concat(null===(c=t.getState())||void 0===c||null===(s=c.anuga)||void 0===s||null===(d=s.projectData)||void 0===d?void 0:d.id,"/").concat(f.apiKey,"/").concat(f.id,"/"),{title:n.newTitle}))})).switchMap((function(){return o().Observable.empty()}))}))},tn=function(n,t){return t.getState,n.ofType(A.UPDATE_ANUGA_RESOURCES).switchMap((function(n){return n.action,o().Observable.defer((function(){return i().get((0,p.zL)("/anuga/api/project/"),{params:{page_size:100,page:1}}).then((function(n){return n.data}))})).switchMap((function(n){var t,e;return o().Observable.of((0,A.setAnugaResources)({projects:E(n),isNextPageAvailable:!(null==n||null===(t=n.links)||void 0===t||!t.next),isPreviousPageAvailable:!(null==n||null===(e=n.links)||void 0===e||!e.previous),loading:!1}))})).catch((function(n){return o().Observable.of((0,_.mN)(n.data||n.message),(0,A.setAnugaResources)({loading:!1}))})).startWith((0,A.setAnugaResources)({loading:!0}))}))}},375501:(n,t,e)=>{"use strict";e.d(t,{Z:()=>A});var r=e(368658),o=e(351288);function a(n){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a(n)}function i(n){return function(n){if(Array.isArray(n))return u(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,t){if(n){if("string"==typeof n)return u(n,t);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(n,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=Array(t);e<t;e++)r[e]=n[e];return r}function l(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function c(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?l(Object(e),!0).forEach((function(t){s(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function s(n,t,e){return(t=function(n){var t=function(n,t){if("object"!=a(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var r=e.call(n,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==a(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var d={showAddAnugaElevationData:!1,visibleAnugaScenarioLogId:!1,scenarios:[]};const A=function(){var n,t,e,a,u,l,s,A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,f=arguments.length>1?arguments[1]:void 0;switch(console.log("action for Anuga: ",f),f.type){case r.SET_CREATING_ANUGA_LAYER:return c(c({},A),{},{isCreatingAnugaLayer:f.isCreatingAnugaLayer});case r.SET_ANUGA_RESOURCES:console.log("** anugaHomePageResources",f.data);var v=null===(n=f.data)||void 0===n||null===(t=n.projects)||void 0===t?void 0:t.map((function(n){return null==n?void 0:n.base_map_full})).filter((function(n){return!(null!=n&&n.featured)}));return console.log("projects:",v),v&&v.sort((function(n,t){var e=null!=n&&n.base_map_full?new Date(n.base_map_full.last_updated):new Date(0);return(null!=t&&t.base_map_full?new Date(t.base_map_full.last_updated):new Date(0))-e})),console.log("projects2:",v),c(c({},A),{},{anugaHomePageResources:c(c({},f.data),{},{projects:v})});case r.UPDATE_ANUGA_SCENARIO:return c(c({},A),{},{scenarios:A.scenarios.map((function(n){return n.id===f.scenario.id?(f.scenario.unsaved=!0,f.scenario):n}))});case r.UPDATE_NETWORK:return c(c({},A),{},{networks:A.networks.map((function(n){return n.id===f.network.id?(f.network.unsaved=!0,f.network):n}))});case r.TOGGLE_SCENARIO_SELECTED:return c(c({},A),{},{scenarios:A.scenarios.map((function(n){return n.id===f.scenario.id?(f.scenario.selected=!n.selected,f.scenario):n}))});case r.SET_ANUGA_POLLING_DATA:var _=A.scenarios.map((function(n){var t=f.scenarios.filter((function(t){return n.id===t.id}))[0];return n.latest_run=c({},null==t?void 0:t.latest_run),n.status=(null==t?void 0:t.status)||"unsaved",n.latest_run_is_valid=null==t?void 0:t.latest_run_is_valid,n})),p=null===(e=A.scenarios)||void 0===e?void 0:e.map((function(n){return null==n?void 0:n.id})),E=null===(a=f.scenarios)||void 0===a||null===(u=a.filter((function(n){return!p.includes(n.id)})))||void 0===u?void 0:u[0];return E&&(_=[].concat(i(_),[E])),c(c({},A),{},{scenarios:_,selectedScenario:f.scenarios.filter((function(n){return A.selectedScenarioId===n.id}))[0]});case r.ADD_ANUGA_SCENARIO:return c(c({},A),{},{scenarios:[].concat(i(A.scenarios),[{id:null,name:"",code:null,description:"",maximum_triangle_area:1e3,constant_rainfall:null,duration:null,status:"new",project:null==A||null===(l=A.projectData)||void 0===l?void 0:l.id,boundary:"",elevation:"",log:"log placeholder",unsaved:!1,selected:!1}])});case r.SET_ANUGA_SCENARIO_IS_LOADED:return c(c({},A),{},{scenarios:A.scenarios.map((function(n){return n.id===f.scenarioId?(n.isLoaded=f.isLoaded,n):n}))});case r.SHOW_ANUGA_SCENARIO_LOG:return c(c({},A),{},{visibleAnugaScenarioLogId:f.scenarioId});case r.SHOW_ANUGA_RUN_MENU:return c(c({},A),{},{visibleAnugaRunMenu:f.visible});case r.SAVE_ANUGA_SCENARIO_SUCCESS:return c(c({},A),{},{scenarios:A.scenarios.map((function(n){return n.id===f.scenario.id?(f.scenario.unsaved=!1,f.scenario):n.id?n:f.scenario}))});case r.SELECT_ANUGA_SCENARIO:return c(c({},A),{},{selectedScenarioId:f.scenario.id,selectedScenario:f.scenario});case r.SET_ANUGA_PROJECT_DATA:return c(c({},A),{},{projectData:f.data});case r.SET_ANUGA_SCENARIO_DATA:return 0===A.scenarios.length?c(c({},A),{},{scenarios:f.scenarios}):c(c({},A),{},{scenarios:null===(s=A.scenarios)||void 0===s?void 0:s.map((function(n){var t;return n.unsaved?c(c({},f.scenario),{},{unsaved:!0}):(null==n?void 0:n.id)===(null===(t=f.scenario)||void 0===t?void 0:t.id)?(f.scenario.unsaved=!1,f.scenario):n}))});case r.UPDATE_COMPUTE_INSTANCE_SUCCESS:return c(c({},A),{},{computeInstances:f.data});case r.SET_COMPARISON_DATA:return c(c({},A),{},{comparisons:f.data});case r.SET_ANUGA_INFLOW_DATA:return c(c({},A),{},{inflows:f.data});case r.SET_ANUGA_FRICTION_DATA:return c(c({},A),{},{frictions:f.data});case r.SET_ANUGA_STRUCTURE_DATA:return c(c({},A),{},{structures:f.data});case r.SET_ANUGA_BOUNDARY_DATA:return c(c({},A),{},{boundaries:f.data});case r.SET_ANUGA_ELEVATION_DATA:return c(c({},A),{},{elevations:f.data});case r.SET_ANUGA_FULL_MESH_DATA:return c(c({},A),{},{fullMeshes:f.data});case r.SET_ANUGA_MESH_REGION_DATA:return c(c({},A),{},{meshRegions:f.data});case r.SET_NETWORK_DATA:return c(c({},A),{},{networks:f.data});case r.SET_LUMPED_CATCHMENT_DATA:return c(c({},A),{},{catchments:f.data});case r.SET_ANUGA_NODES_DATA:return c(c({},A),{},{nodes:f.data});case r.SET_ANUGA_LINKS_DATA:return c(c({},A),{},{links:f.data});case r.SET_PUBLICATION_DATA:return c(c({},A),{},{publications:f.data});case o.SET_OPEN_MENU_GROUP_ID:return f.openMenuGroupId?c(c({},A),{},{showAnugaInputMenu:!1,showAnugaScenarioMenu:!1,showAnugaResultMenu:!1}):A;case r.SET_ANUGA_INPUT_MENU:return c(c({},A),{},{showAnugaInputMenu:f.visible,showAnugaScenarioMenu:!1,showAnugaResultMenu:!1,showNetworkMenu:!1,showReviewPanel:!1,showPublicationPanel:!1});case r.SET_ANUGA_SCENARIO_MENU:return c(c({},A),{},{showAnugaInputMenu:!1,showAnugaScenarioMenu:f.visible,showAnugaResultMenu:!1,showNetworkMenu:!1,showReviewPanel:!1,showPublicationPanel:!1});case r.SET_ANUGA_RESULT_MENU:return c(c({},A),{},{showAnugaScenarioMenu:!1,showAnugaInputMenu:!1,showAnugaResultMenu:f.visible,showNetworkMenu:!1,showReviewPanel:!1,showPublicationPanel:!1});case r.SET_NETWORK_MENU:return c(c({},A),{},{showAnugaInputMenu:!1,showAnugaScenarioMenu:!1,showAnugaResultMenu:!1,showNetworkMenu:f.visible,showReviewPanel:!1,showPublicationPanel:!1});case r.SET_REVIEW_PANEL:return c(c({},A),{},{showAnugaInputMenu:!1,showAnugaScenarioMenu:!1,showAnugaResultMenu:!1,showNetworkMenu:!1,showReviewPanel:f.visible,showPublicationPanel:!1});case r.SET_PUBLICATION_PANEL:return c(c({},A),{},{showAnugaInputMenu:!1,showAnugaScenarioMenu:!1,showAnugaResultMenu:!1,showNetworkMenu:!1,showReviewPanel:!1,showPublicationPanel:f.visible});default:return A}}},926036:(n,t,e)=>{"use strict";function r(n){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r(n)}function o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?o(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):o(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function i(n,t,e){return(t=function(n){var t=function(n,t){if("object"!=r(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var o=e.call(n,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==r(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}e.d(t,{rP:()=>u,Dh:()=>l,mn:()=>c,Z7:()=>s});var u=function(n){var t,e,r,o,a,i,u=null==n||null===(t=n.security)||void 0===t||null===(e=t.user)||void 0===e?void 0:e.pk,l=null==n||null===(r=n.gnresource)||void 0===r||null===(o=r.compactPermissions)||void 0===o||null===(a=o.users)||void 0===a||null===(i=a.filter((function(n){return n.id===u}))[0])||void 0===i?void 0:i.permissions;return["view","edit","manage","owner"].includes(l)},l=function(n){var t,e,r,o,a,i,u=null==n||null===(t=n.security)||void 0===t||null===(e=t.user)||void 0===e?void 0:e.pk,l=null==n||null===(r=n.gnresource)||void 0===r||null===(o=r.compactPermissions)||void 0===o||null===(a=o.users)||void 0===a||null===(i=a.filter((function(n){return n.id===u}))[0])||void 0===i?void 0:i.permissions;return["edit","manage","owner"].includes(l)},c=function(n){var t;return null==n||null===(t=n.anuga)||void 0===t?void 0:t.scenarios.filter((function(n){return null==n?void 0:n.selected}))},s=function(n){var t={elevations:"elevation",boundaries:"boundary",frictions:"friction",inflows:"inflow",meshRegions:"mesh-region",structures:"structure",catchments:"catchment",nodes:"nodes",links:"links"},e=Array();return["elevations","boundaries","frictions","inflows","meshRegions","structures","catchments","nodes","links"].map((function(r){var o;null==n||null===(o=n.anuga)||void 0===o||o[r].map((function(n){e.push(a(a({},n),{},{apiKey:t[r]}))}))})),e}}}]);