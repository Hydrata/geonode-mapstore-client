(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[91701],{501157:(e,t,n)=>{"use strict";n.d(t,{en:()=>E,FU:()=>_,gs:()=>G,tt:()=>W,jY:()=>$,QQ:()=>k,B8:()=>I,T6:()=>U,ZP:()=>F});var r=n(472500),i=n.n(r),o=n(701469),a=n.n(o),u=n(984596),l=n.n(u),s=n(227361),c=n.n(s),p=n(441609),f=n.n(p),y=n(264721),d=n.n(y),g=n(944908),m=n.n(g),b=n(727418),v=n.n(b),h=n(505055),S=n.n(h),O=n(375875),L=n.n(O),w=n(737275),x=n(896309),j=n(396606);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C={},E=function(e){var t=(a()(e)&&e||e.split(","))[0],n=i().parse(t,!0);return i().format(v()({},n,{search:null},{query:v()({service:"WMS",version:"1.3.0",request:"GetCapabilities"},n.query)}))},M=function(e){var t=e&&e.Title,n=e.LogoURL&&R(R({},c()(e,"LogoURL.$")||{}),{},{format:c()(e,"LogoURL.Format")}),r=c()(e,'OnlineResource.$["xlink:href"]');return{title:t,logo:n,imageUrl:c()(e,'LogoURL.OnlineResource.$["xlink:href"]'),link:r}},D=function e(t){return t.Layer?(a()(t.Layer)&&t.Layer||[t.Layer]).reduce((function(t,n){return t.concat(e(n)).concat(n.Layer&&n.Name?[n]:[])}),[]):t.Name&&[t]||[]},T=function(e){return e.Request&&e.Request.GetMap&&e.Request.GetMap.DCPType&&e.Request.GetMap.DCPType.HTTP&&e.Request.GetMap.DCPType.HTTP.Get&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource.$||void 0},q=function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,l=(r.WMS_Capabilities||r.WMT_MS_Capabilities||{}).Capability,s=(r.WMS_Capabilities||r.WMT_MS_Capabilities||{}).Service,c=T(l),p=l.Layer&&(null===(e=l.Layer.SRS||l.Layer.CRS)||void 0===e?void 0:e.map((function(e){return e.toUpperCase()})))||[],f=l.Layer&&l.Layer.Attribution&&M(l.Layer.Attribution),y=l.Request&&l.Request.GetMap&&l.Request.GetMap.Format||[],d=D(l),g=a()(d)?d:[d],m=g.filter((function(e){return!u||-1!==e.Name.toLowerCase().indexOf(u.toLowerCase())||e.Title&&-1!==e.Title.toLowerCase().indexOf(u.toLowerCase())||e.Abstract&&-1!==e.Abstract.toLowerCase().indexOf(u.toLowerCase())}));return{numberOfRecordsMatched:m.length,numberOfRecordsReturned:Math.min(o,m.length),nextRecord:i+Math.min(o,m.length)+1,service:s,layerOptions:{version:(null===(t=r.WMS_Capabilities||r.WMT_MS_Capabilities)||void 0===t||null===(n=t.$)||void 0===n?void 0:n.version)||"1.3.0"},records:m.filter((function(e,t){return t>=i-1&&t<i-1+o})).map((function(e){return v()({},e,{formats:y,onlineResource:c,SRS:p,credits:e.Attribution?M(e.Attribution):f})}))}},_=function(e,t){var r=i().parse(e,!0),o=i().format(v()({},r,{query:v()({service:"WMS",version:"1.1.1",request:"GetCapabilities"},r.query)}));return new Promise((function(e){Promise.all([n.e(99942),n.e(67260)]).then(function(){var r=n(967260).unmarshaller;e(L().get(E(o)).then((function(e){var n;if(t)return S().parseString(e.data,{explicitArray:!1},(function(e,t){n=t})),n;var i=r.unmarshalString(e.data);return i&&i.value})))}.bind(null,n)).catch(n.oe)}))},A=function(e,t,n,r){var i=C[e];return i&&(new Date).getTime()<i.timestamp+1e3*((0,w.u8)("cacheExpire")||60)?new Promise((function(e){e(q(i.data,t,n,r))})):L().get(E(e)).then((function(i){var o;return S().parseString(i.data,{explicitArray:!1},(function(e,t){o=t})),C[e]={timestamp:(new Date).getTime(),data:o},q(o,t,n,r)}))},G=function(e,t){var n=i().parse(e,!0),r=i().format(v()({},n,{query:v()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},n.query)}));return L().get(E(r)).then((function(e){var t;return S().parseString(e.data,{explicitArray:!1},(function(e,n){t=n&&n.WMS_DescribeLayerResponse&&n.WMS_DescribeLayerResponse.LayerDescription})),(t=Array.isArray(t)?t:[t]).map((function(e){return R(R({},e&&e.$||{}),{},{layerName:e&&e.$&&e.$.name,query:R({},e&&e.query&&e.query.$||{})})}))}))},W=function(e,t,n,r){return A(e,t,n,r)},$=function(e,t){for(var n=e,r=n.EX_GeographicBoundingBox||n.exGeographicBoundingBox||(0,x.getWMSBoundingBox)(n.BoundingBox)||n.LatLonBoundingBox&&n.LatLonBoundingBox.$||n.latLonBoundingBox;!r&&n.Layer&&n.Layer.length;)r=(n=n.Layer[0]).EX_GeographicBoundingBox||n.exGeographicBoundingBox||(0,x.getWMSBoundingBox)(n.BoundingBox)||n.LatLonBoundingBox&&n.LatLonBoundingBox.$||n.latLonBoundingBox;r||(r={westBoundLongitude:-180,southBoundLatitude:-90,eastBoundLongitude:180,northBoundLatitude:90});var i={extent:[r.westBoundLongitude||r.minx,r.southBoundLatitude||r.miny,r.eastBoundLongitude||r.maxx,r.northBoundLatitude||r.maxy],crs:"EPSG:4326"};return t?{crs:i.crs,bounds:{minx:i.extent[0],miny:i.extent[1],maxx:i.extent[2],maxy:i.extent[3]}}:i},k=[{label:"image/png",value:"image/png"},{label:"image/png8",value:"image/png8"},{label:"image/jpeg",value:"image/jpeg"},{label:"image/vnd.jpeg-png",value:"image/vnd.jpeg-png"},{label:"image/vnd.jpeg-png8",value:"image/vnd.jpeg-png8"},{label:"image/gif",value:"image/gif"}],I=function(){return m()(Object.values((0,j.eq)()))},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _(e).then((function(e){var n,r,i=c()(e,"capability.request.getMap.format",[]);if(f()(i))n=k;else{var o=k.map((function(e){return e.value}));n=(i=i.map((function(e){var t=e.value;return{label:t,value:t}}))).filter((function(e){var t=e.value;return d()(o,t)}))||[]}if(t){var a=c()(e,"capability.request.getFeatureInfo.format",[]),u=I();f()(a)?r=u:(a=a.map((function(e){return e.value})),r=m()(a.filter((function(e){return d()(u,e)})))||[])}return t?{imageFormats:n,infoFormats:r}:n})).catch((function(){return t?{imageFormats:k,infoFormats:I()}:k}))};const F={flatLayers:D,parseUrl:E,getDimensions:function(e){return l()(e.Dimension||e.dimension||[]).map((function(t,n){var r=e.Extent&&l()(e.Extent)[n]||e.extent&&l()(e.extent)[n];return{name:t.$.name,units:t.$.units,unitSymbol:t.$.unitSymbol,default:t.$.default||r&&r.$.default,values:t._&&t.split(",")||r&&r._&&r.split(",")}}))},getCapabilities:_,describeLayer:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i().parse(e,!0),a=i().format(v()({},o,{query:v()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},o.query,r.query||{})}));return new Promise((function(e){Promise.all([n.e(99942),n.e(67260)]).then(function(){var t=n(967260).unmarshaller;e(L().get(E(a)).then((function(e){var n=t.unmarshalString(e.data);return n&&n.value&&n.value.layerDescription&&n.value.layerDescription[0]})))}.bind(null,n)).catch(n.oe)}))},getRecords:A,describeLayers:G,textSearch:W,parseLayerCapabilities:function e(t,n,r){return l()(r||c()(t,"capability.layer.layer")).reduce((function(r,i){return r||(!i.name&&i.layer?e(t,n,l()(i.layer)):2===n.name.split(":").length&&i.name&&2===i.name.split(":").length?n.name===i.name&&i:i.name&&2===i.name.split(":").length?n.name===i.name.split(":")[1]&&i:2===n.name.split(":").length?n.name.split(":")[1]===i.name&&i:n.name===i.name&&i)}),null)},getBBox:$,reset:function(){Object.keys(C).forEach((function(e){delete C[e]}))},getUniqueInfoFormats:I,getSupportedFormat:U}},398592:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>W});var r=n(701469),i=n.n(r),o=n(747037),a=n.n(o),u=n(727418),l=n.n(u),s=n(45697),c=n.n(s),p=n(124852),f=n.n(p),y=n(171703),d=n(867076),g=n(22222),m=n(580416),b=n(396909),v=n(615402),h=n(965539),S=n(982030),O=n(173014),L=n(532425),w=n(274621),x=n(893222),j=n(99009),P=n(278720);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t){return(D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(l,e);var t,n,r,o,u=(r=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(r);if(o){var n=q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function l(){return E(this,l),u.apply(this,arguments)}return t=l,(n=[{key:"UNSAFE_componentWillMount",value:function(){var e=!this.props.editingAllowedRoles||i()(this.props.editingAllowedRoles)&&a()(this.props.userRole)&&-1!==this.props.editingAllowedRoles.indexOf(this.props.userRole);this.props.onInit(this.props.styleService,e&&(0,j.uW)(this.props.layer,this.props.styleService))}},{key:"render",value:function(){return f().createElement(h.Z,{className:"ms-style-editor-container",header:this.props.showToolbar?f().createElement("div",{className:"ms-style-editor-container-header"},this.props.header,f().createElement("div",{className:"text-center"},f().createElement(P.lC,{enableSetDefaultStyle:this.props.enableSetDefaultStyle}))):null,footer:f().createElement("div",{style:{height:25}})},this.props.isEditing?f().createElement(P.m2,{config:this.props.editorConfig}):f().createElement(P.tM,{showDefaultStyleIcon:this.props.canEdit&&this.props.enableSetDefaultStyle}))}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(f().Component);_(A,"propTypes",{layer:c().object,header:c().node,isEditing:c().bool,showToolbar:c().node.bool,onInit:c().func,styleService:c().object,userRole:c().string,editingAllowedRoles:c().array,enableSetDefaultStyle:c().bool,canEdit:c().bool,editorConfig:c().object}),_(A,"defaultProps",{layer:{},onInit:function(){},editingAllowedRoles:["ADMIN"],editorConfig:{}});var G=(0,d.compose)(d.toClass,(0,d.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.active;return!t}),(function(){return function(){return null}})),(0,y.connect)((0,g.P1)([x.ex,x.aN,x.Vf,x.p,w.L3,x.z_,x.Z0],(function(e,t,n,r,i,o,a){return{isEditing:"edit"===e,loading:t,layer:n,error:r,userRole:i,canEdit:o,styleService:a}})),{onInit:b.E0,onUpdateParams:m.Xy},(function(e,t,n){var r,i,o,a=(null===(r=n.styleService)||void 0===r?void 0:r.baseUrl)===(null===(i=e.styleService)||void 0===i?void 0:i.baseUrl)&&(null===(o=e.styleService)||void 0===o?void 0:o.isStatic),u=n.styleService&&!a?C(C({},n.styleService),{},{isStatic:!0}):C({},e.styleService);return C(C(C(C({},n),e),t),{},{styleService:u})})),(0,S.Z)((function(e){var t=e.error;return!!(null!=t&&t.availableStyles||null!=t&&t.global||null!=t&&t.parsingCapabilities)}),(function(e){var t=e.error;return{glyph:"exclamation-mark",title:f().createElement(v.Z,{msgId:"styleeditor.errorTitle"}),description:f().createElement(v.Z,{msgId:((null==t?void 0:t.availableStyles)?"styleeditor.missingAvailableStylesMessage":(null==t?void 0:t.parsingCapabilities)&&"styleeditor.parsingCapabilitiesError")||(null==t?void 0:t.global)&&"styleeditor.globalError"}),style:{display:"flex",width:"100%",height:"100%",overflow:"hidden"},mainViewStyle:{margin:"auto",width:300}}})),(0,O.Z)((function(e){return"global"===e.loading}),{size:150,style:{margin:"auto"}},(function(e){return f().createElement("div",{style:{position:"relative",height:"100%",display:"flex"}},f().createElement(L.Z,e))})),(0,d.compose)((0,y.connect)((function(){return{}}),{toggleStyleEditor:b.Wv}),(0,d.lifecycle)({componentDidMount:function(){this.props.toggleStyleEditor(null,!0)}})))(A);const W={StyleEditorPlugin:l()(G,{TOC:{priority:1,container:"TOCItemSettings"},TOCItemsSettings:{name:"StyleEditor",target:"style",priority:1,ToolbarComponent:P.lC}}),reducers:{styleeditor:n(532244).Z},epics:n(394943).ZP}},274621:(e,t,n)=>{"use strict";n.d(t,{np:()=>r,L3:()=>i,jl:()=>o,y8:()=>a,qg:()=>u}),n(727418),n(227361);var r=function(e){return e&&e.security&&e.security.user},i=function(e){return r(e)&&r(e).role},o=function(e){return e&&e.security&&e.security.user},a=function(e){return e.security&&e.security.token},u=function(e){return"ADMIN"===i(e)}}}]);